<h2 mat-dialog-title>{{ pageTitle() }}</h2>

<mat-dialog-content class="dialog-content">
  <div class="plan-form-page">
    <header class="page-hero">
      <p class="subtitle">{{ pageSubtitle }}</p>
    </header>

    <mat-card class="form-card">
      <div class="form-header">
        <h3>Informações do Plano</h3>
      </div>

      <form [formGroup]="form" (ngSubmit)="submit()" class="form-body">
        <!-- Ícone -->
        <mat-form-field appearance="fill" class="form-field">
          <mat-label>Ícone</mat-label>
          <mat-select formControlName="icon" placeholder="Selecione um ícone">
            @for (ic of icons; track ic) {
              <mat-option [value]="ic.value">
                <mat-icon style="margin-right: 8px">{{ ic.value }}</mat-icon> {{ ic.label }}
              </mat-option>
            }
          </mat-select>
          @if (form.get('icon')?.hasError('required')) {
            <mat-error
              >Selecione um ícone</mat-error
              >
            }
          </mat-form-field>

          <!-- Título -->
          <mat-form-field appearance="fill" class="form-field">
            <mat-label>Título</mat-label>
            <input
              matInput
              formControlName="title"
              placeholder="Ex: Plano Básico"
              />
              @if (form.get('title')?.hasError('required')) {
                <mat-error
                  >Informe o título</mat-error
                  >
              }
              @if (form.get('title')?.hasError('minlength')) {
                <mat-error
                  >Mínimo de 3 caracteres</mat-error
                  >
                }
              </mat-form-field>

              <div class="row-2">
                <!-- Valor (máscara BRL) -->
                <mat-form-field appearance="fill" class="form-field">
                  <mat-label>Valor</mat-label>
                  <span matPrefix>R$&nbsp;</span>
                  <input
                    matInput
                    formControlName="price"
                    placeholder="0,00"
                    inputmode="numeric"
                    (input)="onPriceInput($event)"
                    (blur)="onPriceBlur()"
                    />
                    @if (form.get('price')?.hasError('required')) {
                      <mat-error
                        >Informe o valor</mat-error
                        >
                    }
                  </mat-form-field>

                  <!-- Período -->
                  <mat-form-field appearance="fill" class="form-field">
                    <mat-label>Período</mat-label>
                    <mat-select formControlName="period">
                      @for (p of periods; track p) {
                        <mat-option [value]="p">{{
                          p
                        }}</mat-option>
                      }
                    </mat-select>
                    @if (form.get('period')?.hasError('required')) {
                      <mat-error
                        >Selecione o período</mat-error
                        >
                      }
                    </mat-form-field>
                  </div>

                  <!-- Características -->
                  <div class="features-header">
                    <h3>Características</h3>
                    <button type="button" mat-stroked-button (click)="addFeature()">
                      <mat-icon>add</mat-icon> Adicionar
                    </button>
                  </div>

                  <div class="features-list">
                    @for (ctrl of featuresFA.controls; track ctrl; let i = $index) {
                      <div
                        class="feature-item"
                        >
                        <mat-form-field appearance="fill" class="feature-field">
                          <input
                            matInput
                            [formControl]="ctrl"
                            placeholder="Ex: Até 50 alunos"
                            />
                          </mat-form-field>
                          <button
                            type="button"
                            mat-icon-button
                            color="warn"
                            class="remove-btn"
                            (click)="removeFeature(i)"
                            [disabled]="featuresFA.length === 1"
                            aria-label="Remover característica"
                            title="Remover"
                            >
                            <mat-icon>close</mat-icon>
                          </button>
                        </div>
                      }

                      @if (
                        featuresFA.hasError('minOneFeature') &&
                        (featuresFA.dirty || featuresFA.touched)
                        ) {
                        <mat-error
                          >
                          Informe pelo menos uma característica.
                        </mat-error>
                      }
                    </div>
                  </form>
                </mat-card>
              </div>
            </mat-dialog-content>

            <mat-dialog-actions align="end" class="dialog-actions">
              <button type="button" mat-stroked-button (click)="cancel()">Cancelar</button>
              <button type="submit" mat-flat-button color="primary" (click)="submit()">
                {{ ctaLabel() }}
              </button>
            </mat-dialog-actions>
